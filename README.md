# Adver-City

![visualization](docs/figs/sample.gif "Adver-City Scenarios")

The first open-source synthetic dataset for collaborative perception focused on adverse weather conditions.

### Paper 

Our paper "Adver-City: Open-Source Multi-Modal Dataset for Collaborative Perception Under Adverse Weather Conditions" 
will soon be available on [Arxiv](https://arxiv.org/).

### Abstract

> Adverse weather conditions pose a significant challenge to the widespread adoption of Autonomous Vehicles (AVs) by 
> impacting sensors like LiDARs and cameras. Even though Collaborative Perception (CP) improves AV perception in 
> difficult conditions, existing CP datasets lack adverse weather conditions. To address this, we introduce Adver-City, 
> the first open-source synthetic CP dataset focused on adverse weather conditions. Simulated in CARLA with OpenCDA, 
> it contains over 24 thousand frames, over 890 thousand annotations, and 110 unique scenarios across six 
> different weather conditions: clear weather, soft rain, heavy rain, fog, foggy heavy rain and, for the first time 
> in a synthetic CP dataset, glare. It has six object categories including pedestrians and cyclists, and uses data 
> from vehicles and roadside units featuring LiDARs, RGB and semantic segmentation cameras, GNSS, and IMUs. Its 
> scenarios, based on real crash reports, depict the most relevant road configurations for adverse weather and poor 
> visibility conditions, varying in object density, with both dense and sparse scenes, allowing for novel testing 
> conditions of CP models. Benchmarks run on the dataset show that weather conditions created challenging conditions 
> for perception models, reducing multi-modal object detection performance by up to 19%, while object density 
> affected LiDAR-based detection by up to 29%. The dataset, code and documentation are available at 
> https://labs.cs.queensu.ca/quarrg/datasets/adver-city/. 



---


## Data

The Adver-City dataset may be downloaded from its [official website](https://labs.cs.queensu.ca/quarrg/datasets/adver-city/). Check the 
[Data structure](docs/data_structure.md) documentation for details on how the dataset files are organized.

## Annotations

We follow an annotation schema compatible with 
[OPV2V](https://opencood.readthedocs.io/en/latest/md_files/data_annotation_tutorial.html). For detailed information, 
check the [Annotation](docs/annotations.md) documentation. 

---

## Installation
Adver-City was built using CARLA v0.9.12 and OpenCDA, so check 
[OpenCDA's installation tutorial](https://opencda-documentation.readthedocs.io/en/latest/md_files/installation.html) 
for detailed instructions on how to install CARLA and the necessary packages.

Besides the packages used by OpenCDA, Adver-City also Pandas 1.3.5, which can be installed by running:

```bash
pip install pandas==1.3.5
```

Pandas is only required for generating statistics of the scenarios.

## Getting Started
To run all scenarios, generating their videos (`-v`) and summaries (`-m`), run:

```bash
python main.py -v y -m y
```

Having the summary files for all scenarios, the statistics may be generated by running the following command with the 
appropriate path argument (`-p`):

```bash
python generate_statistics.py -p data_dumping/2024_06_14_12_47_41
```

To run a single scenario, select a road configuration (`-s`), weather condition (`-w`) and density setting (`-d`) and 
run the command with their abbreviations (refer to the Scenarios section below). For the Urban Intersection Clear Night 
Sparse scenario, the command would be:

```bash
python main.py -s ui -w cn -d s -v y -m y
```

## Scenarios

Adver-City's scenarios provide a rich testbed for comparing how models perform on varying environmental conditions. We 
combine 5 road configurations, 11 weather and daytime conditions and 2 density settings to create a total of 110 unique 
scenarios. 

|     Road Configuration      | Abbreviation |
|:---------------------------:|:------------:|
|     Urban Intersection      |      ui      |
|     Urban Non-Junction      |     unj      |
|     Rural Intersection      |      ri      |
| Rural Straight Non-Junction |     rsnj     |
|  Rural Curved Non-Junction  |     rcnj     |

| Weather and<br/>Daytime Condition | Abbreviation |
|:---------------------------------:|:------------:|
|             Clear Day             |      cd      |
|            Clear Night            |      cn      |
|           Soft Rain Day           |     srd      |
|          Soft Rain Night          |     srn      |
|          Heavy Rain Day           |     hrd      |
|         Heavy Rain Night          |     hrn      |
|             Foggy Day             |      fd      |
|            Foggy Night            |      fn      |
|       Foggy Heavy Rain Day        |     fhrd     |
|      Foggy Heavy Rain Night       |     fhrn     |
|             Glare Day             |      gd      |

| Density Setting | Abbreviation |
|:---------------:|:------------:|
|      Dense      |      d       |
|     Sparse      |      s       |


## Modifying Adver-City

For minor modifications, check the [Scenarios](docs/scenarios.md) documentation.

For more in-depth modifications, check our [documentation](docs/overview.md) for a description on how Adver-City's scenario
generation code works. 

Feel free to fork or create pull requests with your modifications!


---

## BibTeX
If this work is helpful for your research, please cite the following BibTeX entry.
```
@article{Karvat_2024_AdverCity,
  title = {Adver-City: Open-Source Multi-Modal Dataset for Collaborative Perception Under Adverse Weather Conditions},
  author = {Karvat, Mateus and Givigi, Sidney},
  journal = {arXiv preprint arXiv:},
  year = {2024}
}
```

